---
title: "association rules"
output: html_document
date: "2024-01-28"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(arules)
library(arulesViz)
```

## Sleep, health and lifestyle dataset - association rules

```{r read}
health<-read.csv("Sleep_health_and_lifestyle_dataset.csv")
str(health)
```

data summary

```{r summary}

summary(health)
```

```{r}

health<-health[complete.cases(health), ]

```

### Columns

Description based on kaggle "About dataset" tab

```{r}

summary(health$Age)
health$Age =  ifelse(health$Age<18, "Age below 18", 
              ifelse(health$Age<=24, "Age 18-24",
              ifelse(health$Age<=34, "Age 25-34",
              ifelse(health$Age<=44, "Age 35-44",
              ifelse(health$Age<=54, "Age 45-54",
              ifelse(health$Age<=64, "Age 55-64",
              ifelse(health$Age>=65, "Age 65 or above", NA)))))))

```

sleep time in our data has min=5.8 and max 8.5 recommended sleep time for adults is 7-9 hours - in our data there are only adults

```{r}

summary(health$Sleep.Duration)

health$Sleep.Duration =  ifelse(health$Sleep.Duration<7, "Too short sleep", 
                         ifelse(health$Sleep.Duration<=9, "Enought sleep",
                         ifelse(health$Sleep.Duration>9, "Too long sleep"))) 
        
```

```{r}
summary(health$Quality.of.Sleep)

health$Quality.of.Sleep =  ifelse(health$Quality.of.Sleep<=4, "Low quality sleep", 
                           ifelse(health$Quality.of.Sleep<=6, "Medium quality sleep",
                           ifelse(health$Quality.of.Sleep<=8, "Good quality sleep",
                           ifelse(health$Quality.of.Sleep>8, "Very good quality sleep",NA))))
```

### Physical activity level

minutes per day

```{r}
summary(health$Physical.Activity.Level)

health$Physical.Activity.Level =  ifelse(health$Physical.Activity.Level<=30, "Under 30 min of physical activity a day", 
                                  ifelse(health$Physical.Activity.Level<=60, "30-60 min of physical activity a day",
                                  ifelse(health$Physical.Activity.Level>60, "Over 60 min of physical activity a day",NA)))

summary(health$Stress.Level)

hist(health$Stress.Level,xlim=c(0,10))

health$Stress.Level =  ifelse(health$Stress.Level<=2, "Very low stressed",
                       ifelse(health$Stress.Level<=4, "Low stressed", 
                       ifelse(health$Stress.Level<=6, "Medium stressed",
                       ifelse(health$Stress.Level<=8, "Stressed",
                       ifelse(health$Stress.Level>8, "Very stressed",NA)))))
```

### Blood Preasue

variable is character data type

```{r}
summary(health$Blood.Pressure)
```

### Heart Rate (bpm):

The resting heart rate of the person in beats per minute. <https://www.physio-pedia.com/Heart_Rate>

```{r}
summary(health$Heart.Rate)

health$Heart.Rate =  ifelse(health$Heart.Rate<=55, "Excellent heart rate", 
                     ifelse(health$Heart.Rate<=65, "Good heart rate",
                     ifelse(health$Heart.Rate<=75, "Avrage heart rate",
                     ifelse(health$Heart.Rate<=85, "Poor heart rate",       
                     ifelse(health$Heart.Rate>85, "Bad heart rate",NA)))))
                   
```

## 

<https://www.10000steps.org.au/articles/healthy-lifestyles/counting-steps/>

```{r}
summary(health$Daily.Steps)

health$Daily.Steps =  ifelse(health$Daily.Steps<=5000, "Sedentary daily steps", 
                      ifelse(health$Daily.Steps<=7499, "Low daily steps",
                      ifelse(health$Daily.Steps<=9999, "Somewhat active daily steps",
                      ifelse(health$Daily.Steps<=12499, "Active daily steps",       
                      ifelse(health$Daily.Steps>12500, "Highly active daily steps",NA)))))
```

```{r}
summary(health$BMI.Category)
unique(health$BMI.Category)
health$BMI.Category = ifelse(health$BMI.Category=="Normal", "Normal weight",
                      ifelse(health$BMI.Category=="Overweight", "Overweight",
                      ifelse(health$BMI.Category=="Obese", "Obese",NA)))
```

```{r}
health_clean=health[c(2:13)]
str(health_clean)
write.csv(health_clean, file = 'health_clean.csv')

```

```{r}
transactions = read.transactions('health_clean.csv', format='basket', sep=',', skip=0)
inspect(transactions[1:10])
size(transactions) 
length(transactions)
```

------------------------------------------------------------------------

------------------------------------------------------------------------

```{r}
round(itemFrequency(transactions),3) %>% sort(.,decreasing=T) %>% head(10)
```

### standard rules

```{r}

rules.transactions<-apriori(transactions, parameter=list(supp=0.1, conf=0.5))
rules.transactionsSorted<-sort(rules.transactions, by="lift", decreasing=TRUE)
inspect(head(rules.transactionsSorted))

rules_head <- head(rules.transactionsSorted,10)
plot(rules_head, method="graph")
```

```{r}
#stressed rule
rulesStressed<-apriori(data=transactions, parameter=list(supp=0.1, conf=0.1), appearance=list(default="lhs", rhs="Stressed"), control=list(verbose=F)) 
rulesStressedSorted<-sort(rulesStressed, by="confidence", decreasing=TRUE)
inspect(head(rulesStressedSorted))
```

```{r}
#overweight rule
rulesOverweight<-apriori(data=transactions, parameter=list(supp=0.1, conf=0.1), appearance=list(default="lhs", rhs="Overweight"), control=list(verbose=F)) 
rulesOverweightSorted<-sort(rulesOverweight, by="confidence", decreasing=TRUE)
inspect(head(rulesOverweightSorted))
```

```{r}
#Insomnia rule
rulesInsomnia<-apriori(data=transactions, parameter=list(supp=0.1, conf=0.1), appearance=list(default="lhs", rhs="Insomnia"), control=list(verbose=F)) 
rulesInsomniaSorted<-sort(rulesInsomnia, by="confidence", decreasing=TRUE)
inspect(head(rulesInsomniaSorted))
```
